diff --git a/include/cutils/klog.h b/include/cutils/klog.h
index 295d62be..6557716c 100644
--- a/include/cutils/klog.h
+++ b/include/cutils/klog.h
@@ -46,6 +46,6 @@ __END_DECLS
 #define KLOG_INFO(tag,x...)    klog_write(KLOG_INFO_LEVEL, "<6>" tag ": " x)
 #define KLOG_DEBUG(tag,x...)   klog_write(KLOG_DEBUG_LEVEL, "<7>" tag ": " x)
 
-#define KLOG_DEFAULT_LEVEL  3  /* messages <= this level are logged */
+#define KLOG_DEFAULT_LEVEL  7  /* messages <= this level are logged */
 
 #endif
diff --git a/include/system/graphics.h b/include/system/graphics.h
index afd9f7bd..3e04b41e 100644
--- a/include/system/graphics.h
+++ b/include/system/graphics.h
@@ -439,7 +439,21 @@ enum {
     /* Legacy formats (deprecated), used by ImageFormat.java */
     HAL_PIXEL_FORMAT_YCbCr_422_SP       = 0x10, // NV16
     HAL_PIXEL_FORMAT_YCrCb_420_SP       = 0x11, // NV21
+#ifdef SPRD_HARDWARE
+    HAL_PIXEL_FORMAT_YCbCr_422_P        = 0x12,
+    HAL_PIXEL_FORMAT_YCbCr_420_P        = 0x13,
+#endif
     HAL_PIXEL_FORMAT_YCbCr_422_I        = 0x14, // YUY2
+#ifdef SPRD_HARDWARE
+    HAL_PIXEL_FORMAT_YCbCr_420_I        = 0x15,
+    HAL_PIXEL_FORMAT_CbYCrY_422_I       = 0x16,
+    HAL_PIXEL_FORMAT_CbYCrY_420_I       = 0x17,
+    HAL_PIXEL_FORMAT_YCbCr_420_SP_TILED = 0x18,
+    HAL_PIXEL_FORMAT_YCbCr_420_SP       = 0x19,
+    HAL_PIXEL_FORMAT_YCrCb_420_SP_TILED = 0x1A,
+    HAL_PIXEL_FORMAT_YCrCb_422_SP       = 0x1B,
+    HAL_PIXEL_FORMAT_YCrCb_420_P        = 0x1C,
+#endif
 };
 
 /*
diff --git a/init/builtins.cpp b/init/builtins.cpp
index 1681d170..9ab59cba 100644
--- a/init/builtins.cpp
+++ b/init/builtins.cpp
@@ -42,6 +42,7 @@
 #include <cutils/android_reboot.h>
 #include <logwrap/logwrap.h>
 #include <private/android_filesystem_config.h>
+#include <sys/ioctl.h>
 
 #include "init.h"
 #include "keywords.h"
@@ -920,6 +921,15 @@ int do_wait(int nargs, char **args)
         return -1;
 }
 
+int do_pipe(int nargs, char **args) {
+    mode_t mode = get_mode(args[1]);
+    if (mkfifo(args[2], mode) < 0) {
+	ERROR("peter do pipe error haha\n");
+        return -errno;
+    }
+    return 0;
+}
+
 /*
  * Callback to make a directory from the ext4 code
  */
diff --git a/init/init_parser.cpp b/init/init_parser.cpp
index c36d36e2..24ca82b7 100644
--- a/init/init_parser.cpp
+++ b/init/init_parser.cpp
@@ -173,6 +173,7 @@ static int lookup_keyword(const char *s)
         break;
     case 'p':
         if (!strcmp(s, "owerctl")) return K_powerctl;
+        if (!strcmp(s, "ipe")) return K_pipe;   //sprd add for loopback test
         break;
     case 'r':
         if (!strcmp(s, "estart")) return K_restart;
diff --git a/init/keywords.h b/init/keywords.h
index 303685d4..21521e5c 100644
--- a/init/keywords.h
+++ b/init/keywords.h
@@ -39,6 +39,7 @@ int do_load_system_props(int nargs, char **args);
 int do_verity_load_state(int nargs, char **args);
 int do_verity_update_state(int nargs, char **args);
 int do_wait(int nargs, char **args);
+int do_pipe(int nargs, char **args);
 #define __MAKE_KEYWORD_ENUM__
 #define KEYWORD(symbol, flags, nargs, func) K_##symbol,
 enum {
@@ -100,6 +101,7 @@ enum {
     KEYWORD(verity_load_state,      COMMAND, 0, do_verity_load_state)
     KEYWORD(verity_update_state,    COMMAND, 0, do_verity_update_state)
     KEYWORD(wait,        COMMAND, 1, do_wait)
+    KEYWORD(pipe,        COMMAND, 2, do_pipe)
     KEYWORD(write,       COMMAND, 2, do_write)
     KEYWORD(writepid,    OPTION,  0, 0)
 #ifdef __MAKE_KEYWORD_ENUM__
diff --git a/init/property_service.cpp b/init/property_service.cpp
index fe82befe..01474117 100644
--- a/init/property_service.cpp
+++ b/init/property_service.cpp
@@ -361,8 +361,8 @@ static void handle_property_set_fd()
             if (check_perms(msg.name, source_ctx)) {
                 property_set((char*) msg.name, (char*) msg.value);
             } else {
-                ERROR("sys_prop: permission denied uid:%d  name:%s\n",
-                      cr.uid, msg.name);
+                ERROR("sys_prop: permission denied pid:%d uid:%d name:%s\n",
+                      cr.pid, cr.uid, msg.name);
             }
 
             // Note: bionic's property client code assumes that the
diff --git a/libion/Android.mk b/libion/Android.mk
index 6562cd3e..27c88bed 100644
--- a/libion/Android.mk
+++ b/libion/Android.mk
@@ -4,9 +4,10 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES := ion.c
 LOCAL_MODULE := libion
 LOCAL_MODULE_TAGS := optional
-LOCAL_SHARED_LIBRARIES := liblog
-LOCAL_C_INCLUDES := $(LOCAL_PATH)/include $(LOCAL_PATH)/kernel-headers
-LOCAL_EXPORT_C_INCLUDE_DIRS := $(LOCAL_PATH)/include $(LOCAL_PATH)/kernel-headers
+LOCAL_SHARED_LIBRARIES := liblog libcutils
+LOCAL_C_INCLUDES := $(LOCAL_PATH)/include $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include/
+LOCAL_EXPORT_C_INCLUDE_DIRS := $(LOCAL_PATH)/include $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include/
+LOCAL_ADDITIONAL_DEPENDENCIES := $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
 LOCAL_CFLAGS := -Werror
 include $(BUILD_SHARED_LIBRARY)
 
@@ -14,8 +15,9 @@ include $(CLEAR_VARS)
 LOCAL_SRC_FILES := ion.c ion_test.c
 LOCAL_MODULE := iontest
 LOCAL_MODULE_TAGS := optional tests
-LOCAL_C_INCLUDES := $(LOCAL_PATH)/include $(LOCAL_PATH)/kernel-headers
-LOCAL_SHARED_LIBRARIES := liblog
+LOCAL_SHARED_LIBRARIES := liblog libcutils
+LOCAL_C_INCLUDES := $(LOCAL_PATH)/include $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr/include/
+LOCAL_ADDITIONAL_DEPENDENCIES := $(TARGET_OUT_INTERMEDIATES)/KERNEL_OBJ/usr
 LOCAL_CFLAGS := -Werror
 include $(BUILD_EXECUTABLE)
 
diff --git a/libion/include/ion/ion.h b/libion/include/ion/ion.h
index f47793d2..d276b160 100644
--- a/libion/include/ion/ion.h
+++ b/libion/include/ion/ion.h
@@ -35,6 +35,7 @@ int ion_alloc(int fd, size_t len, size_t align, unsigned int heap_mask,
 int ion_alloc_fd(int fd, size_t len, size_t align, unsigned int heap_mask,
               unsigned int flags, int *handle_fd);
 int ion_sync_fd(int fd, int handle_fd);
+int ion_invalidate_fd(int fd, int handle_fd);
 int ion_free(int fd, ion_user_handle_t handle);
 int ion_map(int fd, ion_user_handle_t handle, size_t length, int prot,
             int flags, off_t offset, unsigned char **ptr, int *map_fd);
diff --git a/libion/ion.c b/libion/ion.c
index d1984bd0..33c280b6 100644
--- a/libion/ion.c
+++ b/libion/ion.c
@@ -169,6 +169,15 @@ int ion_import(int fd, int share_fd, ion_user_handle_t *handle)
     return ret;
 }
 
+int ion_invalidate_fd(int fd, int handle_fd)
+{
+    struct ion_fd_data data = {
+        .fd = handle_fd,
+    };
+
+    return ion_ioctl(fd, ION_IOC_INVALIDATE, &data);
+}
+
 int ion_sync_fd(int fd, int handle_fd)
 {
     struct ion_fd_data data = {
