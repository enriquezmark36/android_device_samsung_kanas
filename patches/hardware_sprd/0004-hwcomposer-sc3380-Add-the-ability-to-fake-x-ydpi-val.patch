From 135d27241e3e434ba8c9ed2755f772dadb0012d6 Mon Sep 17 00:00:00 2001
From: Mark Enriquez <enriquezmark36@gmail.com>
Date: Sun, 15 Jul 2018 16:38:32 +0800
Subject: [PATCH 4/6] hwcomposer: sc3380: Add the ability to fake x/ydpi values

Change-Id: I519acf05f91edcd821f05d584b54c099b0f1adbd
Signed-off-by: Mark Enriquez <enriquezmark36@gmail.com>
---
 hwcomposer/scx15/Android.mk         | 10 ++++++++++
 hwcomposer/scx15/SprdHWComposer.cpp | 10 ++++++++++
 2 files changed, 20 insertions(+)

diff --git a/hwcomposer/scx15/Android.mk b/hwcomposer/scx15/Android.mk
index 2783ae8..54e2dec 100644
--- a/hwcomposer/scx15/Android.mk
+++ b/hwcomposer/scx15/Android.mk
@@ -101,6 +101,16 @@ DEVICE_USE_FB_HW_VSYNC := true
 ifneq ($(strip $(SOC_SCX35)),true)
 DEVICE_DIRECT_DISPLAY_SINGLE_OSD_LAYER := true
 endif
+
+# Force x/ydpi values reported by hwcomposer
+ifneq ($(DEVICE_REPORT_XDPI),)
+LOCAL_CFLAGS += -DDEVICE_REPORT_XDPI=$(DEVICE_REPORT_XDPI)
+endif
+
+ifneq ($(DEVICE_REPORT_YDPI),)
+LOCAL_CFLAGS += -DDEVICE_REPORT_YDPI=$(DEVICE_REPORT_YDPI)
+endif
+
 endif
 
 ifeq ($(TARGET_BOARD_PLATFORM),scx15)
diff --git a/hwcomposer/scx15/SprdHWComposer.cpp b/hwcomposer/scx15/SprdHWComposer.cpp
index 5619093..1f04f47 100644
--- a/hwcomposer/scx15/SprdHWComposer.cpp
+++ b/hwcomposer/scx15/SprdHWComposer.cpp
@@ -358,12 +358,22 @@ int SprdHWComposer:: getDisplayAttributes(int disp, uint32_t config, const uint3
                 ALOGI("getDisplayAttributes: disp:%d height:%d", disp, dpyAttr->yres);
                 break;
             case HWC_DISPLAY_DPI_X:
+#ifdef DEVICE_REPORT_XDPI
+                value[i] = (int32_t) DEVICE_REPORT_XDPI * 1000;
+                ALOGI("getDisplayAttributes: disp:%d xdpi:%f overridden at ", disp, dpyAttr->xdpi / 1000.0, DEVICE_REPORT_XDPI);
+#else
                 value[i] = (int32_t)(dpyAttr->xdpi);
                 ALOGI("getDisplayAttributes: disp:%d xdpi:%f", disp, dpyAttr->xdpi / 1000.0);
+#endif
                 break;
             case HWC_DISPLAY_DPI_Y:
+#ifdef DEVICE_REPORT_YDPI
+                value[i] = (int32_t) DEVICE_REPORT_YDPI * 1000;
+                ALOGI("getDisplayAttributes: disp:%d ydpi:%f overridden at ", disp, dpyAttr->ydpi / 1000.0, DEVICE_REPORT_YDPI);
+#else
                 value[i] = (int32_t)(dpyAttr->ydpi);
                 ALOGI("getDisplayAttributes: disp:%d ydpi:%f", disp, dpyAttr->ydpi / 1000.0);
+#endif
                 break;
             default:
                 ALOGE("Unknown Display Attributes:%d", attributes[i]);
-- 
2.19.0

